<!DOCTYPE html><html class="default" lang="en"><head><meta charset="utf-8"/><meta http-equiv="x-ua-compatible" content="IE=edge"/><title>infrastructure | @org</title><meta name="description" content="Documentation for @org"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="../assets/style.css"/><link rel="stylesheet" href="../assets/highlight.css"/><script defer src="../assets/main.js"></script><script async src="../assets/icons.js" id="tsd-icons-script"></script><script async src="../assets/search.js" id="tsd-search-script"></script><script async src="../assets/navigation.js" id="tsd-nav-script"></script><link rel="stylesheet" href="../assets/typedoc-github-style.css"/><script defer src="../assets/docs.js"></script>
</head><body><script>document.documentElement.dataset.theme = localStorage.getItem("tsd-theme") || "os";document.body.style.display="none";setTimeout(() => app?app.showPage():document.body.style.removeProperty("display"),500)</script><header class="tsd-page-toolbar"><div class="tsd-toolbar-contents container"><div class="table-cell" id="tsd-search" data-base=".."><div class="field"><label for="tsd-search-field" class="tsd-widget tsd-toolbar-icon search no-caption"><svg width="16" height="16" viewBox="0 0 16 16" fill="none"><use href="../assets/icons.svg#icon-search"></use></svg></label><input type="text" id="tsd-search-field" aria-label="Search"/></div><div class="field"><div id="tsd-toolbar-links"></div></div><ul class="results"><li class="state loading">Preparing search index...</li><li class="state failure">The search index is not available</li></ul><a href="../index.html" class="title">@org</a></div><div class="table-cell" id="tsd-widgets"><a href="#" class="tsd-widget tsd-toolbar-icon menu no-caption" data-toggle="menu" aria-label="Menu"><svg width="16" height="16" viewBox="0 0 16 16" fill="none"><use href="../assets/icons.svg#icon-menu"></use></svg></a></div></div></header><div class="container container-main"><div class="col-content"><div class="tsd-page-title"><ul class="tsd-breadcrumb"><li><a href="../index.html">@org</a></li><li><a href="app_node_express.html">app-node-express</a></li><li><a href="app_node_express.infrastructure.html">infrastructure</a></li></ul><h1>Module infrastructure</h1></div><section class="tsd-panel tsd-comment"><div class="tsd-comment tsd-typography"><a id="md:overview" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Overview<a href="#md:overview" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><p>The <code>infrastructure</code> directory contains the foundational files and folders specific to the application, including controllers, middleware, repositories, services, and decorators.
It provides core functionality such as user management, routing, security, and dependency injection, while also allowing flexibility for project-specific customizations.
The <code>decorators</code> subdirectory contains core decorators used across the application, though it allows for additional custom decorators if needed by the project.</p>
<p>Unlike core libraries, this folder is project-specific and may vary across implementations. It includes:</p>
<ul>
<li><strong>Controllers</strong>: Handle user-related API requests and route interactions.</li>
<li><strong>Decorators</strong>: Provide core decorators for IoC, autowiring, and route contract management.</li>
<li><strong>Middleware</strong>: Manages request authorization, logging, session handling, and MongoDB session context.</li>
<li><strong>Repository</strong>: Abstracts database interactions with Keycloak for user data retrieval.</li>
<li><strong>Services</strong>: Provides business logic, including user-related services, with mappings from Keycloak to local data models.</li>
</ul>
<a id="md:features" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Features<a href="#md:features" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><ul>
<li><strong>Controllers</strong>: Defines controllers like <code>UserController</code> that handle user-related requests and route mappings using contracts and secured middleware.</li>
<li><strong>Custom Decorators</strong>: Core decorators for injecting dependencies (<code>inject</code>), autowiring (<code>autowired</code>), and handling routes with transaction support (<code>contract</code>).</li>
<li><strong>Middleware Management</strong>: Integrates Keycloak for authorization (<code>withAuthorization</code>), session management (<code>withRouteSession</code>), request logging (<code>withMorgan</code>), and context handling (<code>withRouteContext</code>).</li>
<li><strong>Repository Pattern</strong>: Provides an abstraction over Keycloak Admin API interactions through <code>UserRepository</code>, which handles user data retrieval.</li>
<li><strong>Service Layer</strong>: The <code>UserService</code> class handles core business logic around user management, including mapping Keycloak data to the appâ€™s internal format.</li>
</ul>
<a id="md:how-to-use" class="tsd-anchor"></a><h2 class="tsd-anchor-link">How to Use<a href="#md:how-to-use" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><a id="md:using-controllers" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Using Controllers<a href="#md:using-controllers" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Define routes in <code>UserController</code> using contracts and secured middleware:</p>
<pre><code class="ts"><span class="hl-7">import</span><span class="hl-0"> { </span><span class="hl-5">UserController</span><span class="hl-0"> } </span><span class="hl-7">from</span><span class="hl-0"> </span><span class="hl-2">&quot;@org/app-node-express/infrastructure/controllers&quot;</span><span class="hl-0">;</span><br/><br/><span class="hl-3">const</span><span class="hl-0"> </span><span class="hl-6">userController</span><span class="hl-0"> = </span><span class="hl-3">new</span><span class="hl-0"> </span><span class="hl-1">UserController</span><span class="hl-0">();</span><br/><span class="hl-7">await</span><span class="hl-0"> </span><span class="hl-5">userController</span><span class="hl-0">.</span><span class="hl-1">findAll</span><span class="hl-0">();</span>
</code><button type="button">Copy</button></pre>

<a id="md:using-custom-decorators" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Using Custom Decorators<a href="#md:using-custom-decorators" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>The <code>inject</code> and <code>autowired</code> decorators provide dependency injection and autowiring of services:</p>
<pre><code class="ts"><span class="hl-7">import</span><span class="hl-0"> { </span><span class="hl-5">inject</span><span class="hl-0">, </span><span class="hl-5">autowired</span><span class="hl-0"> } </span><span class="hl-7">from</span><span class="hl-0"> </span><span class="hl-2">&quot;@org/app-node-express/infrastructure/decorators&quot;</span><span class="hl-0">;</span><br/><br/><span class="hl-0">@</span><span class="hl-1">inject</span><span class="hl-0">()</span><br/><span class="hl-3">class</span><span class="hl-0"> </span><span class="hl-4">MyService</span><span class="hl-0"> {</span><br/><span class="hl-0">  @</span><span class="hl-1">autowired</span><span class="hl-0">(</span><span class="hl-2">&quot;UserService&quot;</span><span class="hl-0">)</span><br/><span class="hl-0">  </span><span class="hl-3">private</span><span class="hl-0"> </span><span class="hl-5">userService</span><span class="hl-0">: </span><span class="hl-4">UserService</span><span class="hl-0">;</span><br/><span class="hl-0">}</span>
</code><button type="button">Copy</button></pre>

<a id="md:middleware-integration" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Middleware Integration<a href="#md:middleware-integration" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Use middleware to handle authorization, logging, session management, and route contexts:</p>
<pre><code class="ts"><span class="hl-7">import</span><span class="hl-0"> { </span><span class="hl-5">withAuthorization</span><span class="hl-0">, </span><span class="hl-5">withMorgan</span><span class="hl-0">, </span><span class="hl-5">withRouteSession</span><span class="hl-0">, </span><span class="hl-5">withRouteContext</span><span class="hl-0"> } </span><span class="hl-7">from</span><span class="hl-0"> </span><span class="hl-2">&quot;@org/app-node-express/infrastructure/middleware&quot;</span><span class="hl-0">;</span><br/><br/><span class="hl-5">app</span><span class="hl-0">.</span><span class="hl-1">use</span><span class="hl-0">(</span><span class="hl-1">withAuthorization</span><span class="hl-0">());</span><br/><span class="hl-5">app</span><span class="hl-0">.</span><span class="hl-1">use</span><span class="hl-0">(</span><span class="hl-1">withMorgan</span><span class="hl-0">());</span><br/><span class="hl-5">app</span><span class="hl-0">.</span><span class="hl-1">use</span><span class="hl-0">(</span><span class="hl-1">withRouteSession</span><span class="hl-0">());</span><br/><span class="hl-5">app</span><span class="hl-0">.</span><span class="hl-1">use</span><span class="hl-0">(</span><span class="hl-1">withRouteContext</span><span class="hl-0">());</span>
</code><button type="button">Copy</button></pre>

<a id="md:repositories-and-services" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Repositories and Services<a href="#md:repositories-and-services" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><p>The <code>UserRepository</code> and <code>UserService</code> abstract interactions with Keycloak and provide business logic for user data:</p>
<pre><code class="ts"><span class="hl-3">const</span><span class="hl-0"> </span><span class="hl-6">userService</span><span class="hl-0"> = </span><span class="hl-3">new</span><span class="hl-0"> </span><span class="hl-1">UserService</span><span class="hl-0">();</span><br/><span class="hl-3">const</span><span class="hl-0"> </span><span class="hl-6">users</span><span class="hl-0"> = </span><span class="hl-7">await</span><span class="hl-0"> </span><span class="hl-5">userService</span><span class="hl-0">.</span><span class="hl-1">findAll</span><span class="hl-0">();</span>
</code><button type="button">Copy</button></pre>

<a id="md:customization" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Customization<a href="#md:customization" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h2><ul>
<li><strong>Controllers</strong>: Extend or create new controllers using the contract pattern with decorators like <code>contract</code> and secured middleware.</li>
<li><strong>Decorators</strong>: Add custom decorators as needed by extending the core decorators in the <code>decorators</code> subdirectory.</li>
<li><strong>Middleware</strong>: Adjust or create custom middleware for handling requests, authorization, logging, or context management based on specific project needs.</li>
<li><strong>Repositories and Services</strong>: Extend or modify the repository and service layers to handle additional business logic or external API interactions.</li>
</ul>
</div><div class="tsd-comment tsd-typography"></div></section></div><div class="col-sidebar"><div class="page-menu"><div class="tsd-navigation settings"><details class="tsd-accordion"><summary class="tsd-accordion-summary"><h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none"><use href="../assets/icons.svg#icon-chevronDown"></use></svg>Settings</h3></summary><div class="tsd-accordion-details"><div class="tsd-filter-visibility"><span class="settings-label">Member Visibility</span><ul id="tsd-filter-options"><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-protected" name="protected"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Protected</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-inherited" name="inherited" checked/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Inherited</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-external" name="external"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>External</span></label></li></ul></div><div class="tsd-theme-toggle"><label class="settings-label" for="tsd-theme">Theme</label><select id="tsd-theme"><option value="os">OS</option><option value="light">Light</option><option value="dark">Dark</option></select></div></div></details></div><details open class="tsd-accordion tsd-page-navigation"><summary class="tsd-accordion-summary"><h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none"><use href="../assets/icons.svg#icon-chevronDown"></use></svg>On This Page</h3></summary><div class="tsd-accordion-details"><a href="#md:overview"><span>Overview</span></a><a href="#md:features"><span>Features</span></a><a href="#md:how-to-use"><span>How to <wbr/>Use</span></a><ul><li><a href="#md:using-controllers"><span>Using <wbr/>Controllers</span></a></li><li><a href="#md:using-custom-decorators"><span>Using <wbr/>Custom <wbr/>Decorators</span></a></li><li><a href="#md:middleware-integration"><span>Middleware <wbr/>Integration</span></a></li><li><a href="#md:repositories-and-services"><span>Repositories and <wbr/>Services</span></a></li></ul><a href="#md:customization"><span>Customization</span></a></div></details></div><div class="site-menu"><nav class="tsd-navigation"><a href="../index.html"><svg class="tsd-kind-icon" viewBox="0 0 24 24"><use href="../assets/icons.svg#icon-1"></use></svg><span>@org</span></a><ul class="tsd-small-nested-navigation" id="tsd-nav-container" data-base=".."><li>Loading...</li></ul></nav></div></div></div><footer><p class="tsd-generator">Generated using <a href="https://typedoc.org/" target="_blank">TypeDoc</a> with <a href="https://github.com/KillerJulian/typedoc-github-theme" target="_blank">typedoc-github-theme</a></p></footer><div class="overlay"></div></body></html>
